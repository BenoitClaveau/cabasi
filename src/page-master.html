<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="cabasi-global.html">

<dom-module id="page-master">
  <template>
    <style include="shared-styles">
      /*app-drawer*/
      app-drawer iron-selector {
        display: flex;
        flex-direction: column;
      }
      app-drawer iron-selector > a {
        padding: 16px;
        color: var(--font-color);
        text-decoration: none;
        border-left: 4px solid transparent;
        outline: none;
      }
      app-drawer iron-selector > a.iron-selected {
        border-left: 4px solid var(--active-color);
        color: var(--active-color);
      }
      /**/
      app-header nav {
        font-size: 16px;
        display: flex;
        flex-direction: row;
        align-items: flex-end;
        justify-content: flex-end;
        flex: 1 0 auto;
      }
      app-header nav a {
        padding: 16px 8px;
        color: var(--font-color);
        text-decoration: none;
      }
      app-header nav a.iron-selected {
        border-bottom: 2px solid var(--active-color);
        padding-bottom: 14px;
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subRoute}}"></app-route>

    <cabasi-global
        categories="{{categories}}"
        category-name="[[categoryName]]"
        category="{{category}}"
        sync="{{sync}}"
        offline="[[offline]]"
        failure="{{failure}}">
    </cabasi-global>

    <app-drawer-layout id="drawer-layout" responsive-width="640px">

      <app-drawer id="drawer">
        <app-toolbar>
          <h1>
            <img src="../images/logo.png">
          </h1>
        </app-toolbar>
        <iron-selector id="drawer-nav" attr-for-selected="name" selected="[[categoryName]]">
          <template is="dom-repeat" items="[[categories]]" as="category">
            <a name="[[category.name]]" href="[[category.name]]">[[category.title]]</a>
          </template>
        </iron-selector>
      </app-drawer>

      <app-header-layout>
        <app-header> 
          <app-toolbar id="main-header">
            <div>
              <paper-icon-button icon="icons:menu" drawer-toggle></paper-icon-button>
              <a href="/home" hidden$=[[desktop]]>
                <h1>
                  <img src="../images/logo.png">
                </h1>
              </a>
            </div>
            <nav>
              <iron-selector attr-for-selected="name" selected="[[categoryName]]">
                <template is="dom-repeat" items="[[categories]]" as="category">
                  <a name="[[category.name]]" href="[[category.name]]">[[category.title]]</a>
                </template>
              </iron-selector>
            </nav>
          </app-toolbar>
        </app-header>
        <iron-pages
          selected="[[page]]"
          attr-for-selected="name"
          fallback-selection="home"
          role="main">
          <page-home
            name="home"
            category="[[category]]"
          </page-home>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>
    <iron-media-query query="min-width: 640px" query-matches="{{desktop}}"></iron-media-query>
    <iron-media-query query="max-width: 640px" query-matches="{{mobile}}"></iron-media-query>
  </template>

  <script>
    class PageMaster extends Polymer.Element {
      static get is() { return "page-master"; }

      static get properties() {
        return {
          //route
          route: Object,
          routeData: Object,
          subRoute: Object,

          //cabasi-global
          categories: Array,
          categoryName: String,
          category: Object,
          sync: Boolean,
          offline: Boolean,
          failure: Boolean,

          //repoonsive
          desktop: Boolean,
          mobile: Boolean
        }
      }

      static get observers() {
        return [
          'routeChanged(route.*)',
          'categoriesChanged(categories)'
        ]
      }

      routeChanged(e) {
        this.categoryName = this.routeData.page || "home";
        Polymer.RenderStatus.afterNextRender(this, function() {
          Polymer.importHref(this.resolveUrl(this.categoryName + '/page-' + this.categoryName + '.html'), function() {
              this.$["drawer-layout"].resetLayout();
          }.bind(this));
        });
      }

      appDataChanged(a) {
        console.log("change", a)
      }

    }
    customElements.define(PageMaster.is, PageMaster);
  </script>
</dom-module>